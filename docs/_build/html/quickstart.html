

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quickstart and Basic Usage &mdash; entity_event 0.2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="entity_event 0.2.0 documentation" href="index.html"/>
        <link rel="next" title="Advanced Features" href="advanced_features.html"/>
        <link rel="prev" title="Installation" href="installation.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> entity_event</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-with-pip">Installation with Pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#use-with-django">Use with Django</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Quickstart and Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-and-categorizing-events">Creating and Categorizing Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#managing-mediums-and-subscriptions-to-events">Managing Mediums and Subscriptions to Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#querying-events">Querying Events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced_features.html">Advanced Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="advanced_features.html#custom-context-loaders">Custom Context Loaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_features.html#customizing-only-following-behavior">Customizing Only-Following Behavior</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ref/entity_event.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#running-the-tests">Running the tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#code-quality">Code Quality</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#code-styling">Code Styling</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#building-the-docs">Building the docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#release-checklist">Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#vulnerability-reporting">Vulnerability Reporting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v0-2">v0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html#v0-1">v0.1</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">entity_event</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Quickstart and Basic Usage</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/quickstart.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="quickstart-and-basic-usage">
<span id="quickstart"></span><h1>Quickstart and Basic Usage<a class="headerlink" href="#quickstart-and-basic-usage" title="Permalink to this headline">¶</a></h1>
<p>Django Entity Event is a great way to collect events that your users
care about into a unified location. The parts of your code base that
create these events are probably totally separate from the parts that
display them, which are also separate from the parts that manage
subscriptions to notifications. Django Entity Event makes separating
these concerns as simple as possible, and provides convenient
abstractions at each of these levels.</p>
<p>This quickstart guide handles the three parts of managing events and
notifications.</p>
<ol class="arabic simple">
<li>Creating, and categorizing events.</li>
<li>Defining mediums and subscriptions.</li>
<li>Querying events and presenting them to users.</li>
</ol>
<p>If you are not already using Django Entity, this event framework won&#8217;t
be particularly useful, and you should probably start by integrating
Django Entity into your application.</p>
<div class="section" id="creating-and-categorizing-events">
<h2>Creating and Categorizing Events<a class="headerlink" href="#creating-and-categorizing-events" title="Permalink to this headline">¶</a></h2>
<p>Django Entity Event is structured such that all events come from a
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Source" title="entity_event.models.Source"><tt class="xref py py-class docutils literal"><span class="pre">Source</span></tt></a>, and can be displayed to the
user from a variety of mediums. When we&#8217;re creating events, we
don&#8217;t need to worry much about what
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a> the event will be displayed
on, we do need to know what the
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Source" title="entity_event.models.Source"><tt class="xref py py-class docutils literal"><span class="pre">Source</span></tt></a> of the events are.</p>
<p><a class="reference internal" href="ref/entity_event.html#entity_event.models.Source" title="entity_event.models.Source"><tt class="xref py py-class docutils literal"><span class="pre">Source</span></tt></a> objects are used to categorize
events. Categorizing events allows different types of events to be
consumed differently. So, before we can create an event, we need to
create a <a class="reference internal" href="ref/entity_event.html#entity_event.models.Source" title="entity_event.models.Source"><tt class="xref py py-class docutils literal"><span class="pre">Source</span></tt></a> object. It is a good
idea to use sources to do fine grained categorization of events. To
provide higher level groupings, all sources must reference a
<a class="reference internal" href="ref/entity_event.html#entity_event.models.SourceGroup" title="entity_event.models.SourceGroup"><tt class="xref py py-class docutils literal"><span class="pre">SourceGroup</span></tt></a> object. These objects are
very simple to create. Here we will make a single source group and two
different sources</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">entity_event</span> <span class="kn">import</span> <span class="n">Source</span><span class="p">,</span> <span class="n">SourceGroup</span>

<span class="n">yoursite_group</span> <span class="o">=</span> <span class="n">SourceGroup</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&#39;yoursite&#39;</span><span class="p">,</span>
    <span class="n">display_name</span><span class="o">=</span><span class="s">&#39;Yoursite&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">&#39;Events on Yoursite&#39;</span>
<span class="p">)</span>

<span class="n">photo_source</span> <span class="o">=</span> <span class="n">Source</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">group</span><span class="o">=</span><span class="n">yoursite_group</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&#39;photo-tag&#39;</span><span class="p">,</span>
    <span class="n">display_name</span><span class="o">=</span><span class="s">&#39;Photo Tag&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">&#39;You have been tagged in a photo&#39;</span>
<span class="p">)</span>

<span class="n">product_source</span> <span class="o">=</span> <span class="n">Source</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">group</span><span class="o">=</span><span class="n">yoursite_group</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&#39;new-product&#39;</span><span class="p">,</span>
    <span class="n">display_name</span><span class="o">=</span><span class="s">&#39;New Product&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">&#39;There is a new product on YourSite&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>As seen above, the information required for these sources is fairly
minimal. It is worth noting that while we only defined a single
<a class="reference internal" href="ref/entity_event.html#entity_event.models.SourceGroup" title="entity_event.models.SourceGroup"><tt class="xref py py-class docutils literal"><span class="pre">SourceGroup</span></tt></a> object, it will often
make sense to define more logical
<a class="reference internal" href="ref/entity_event.html#entity_event.models.SourceGroup" title="entity_event.models.SourceGroup"><tt class="xref py py-class docutils literal"><span class="pre">SourceGroup</span></tt></a> objects.</p>
<p>Once we have sources defined, we can begin creating events. To create
an event we use the <a class="reference internal" href="ref/entity_event.html#entity_event.models.EventManager.create_event" title="entity_event.models.EventManager.create_event"><tt class="xref py py-meth docutils literal"><span class="pre">Event.objects.create_event</span></tt></a> method. To create an
event for the &#8220;photo-tag&#8221; group, we just need to know the source of
the event, what entities are involved, and some information about what
happened</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">entity_event</span> <span class="kn">import</span> <span class="n">Event</span>

<span class="c"># Assume we&#39;re within the photo tag processing code, and we&#39;ll</span>
<span class="c"># have access to variables entities_tagged, photo_owner, and</span>
<span class="c"># photo_location</span>

<span class="n">Event</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_event</span><span class="p">(</span>
    <span class="n">source</span><span class="o">=</span><span class="n">photo_source</span><span class="p">,</span>
    <span class="n">actors</span><span class="o">=</span><span class="n">entities_tagged</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
        <span class="s">&#39;photo_owner&#39;</span><span class="p">:</span> <span class="n">photo_owner</span>
        <span class="s">&#39;photo_location&#39;</span><span class="p">:</span> <span class="n">photo_location</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The code above is all that&#8217;s required to store an event. While this is
a fairly simple interface for creating events, in some applications it
may be easier to read, and less intrusive in application code to use
django-signals in the application code, and create events in signal
handlers. In either case, We&#8217;re ready to discuss subscription
management.</p>
</div>
<div class="section" id="managing-mediums-and-subscriptions-to-events">
<h2>Managing Mediums and Subscriptions to Events<a class="headerlink" href="#managing-mediums-and-subscriptions-to-events" title="Permalink to this headline">¶</a></h2>
<p>Once the events are created, we need to define how the users of our
application are going to interact with the events. There are a large
number of possible ways to notify users of events. Email, newsfeeds,
notification bars, are all examples. Django Entity Event doesn&#8217;t
handle the display logic for notifying users, but it does handle the
subscription and event routing/querying logic that determines which
events go where.</p>
<p>To start, we must define a <a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a>
object for each method our users will consume events from. Storing
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a> objects in the database has
two purposes. First, it is referenced when subscriptions are
created. Second the <a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a> objects
provide an entry point to query for events and have all the
subscription logic and filtering taken care of for you.</p>
<p>Like <a class="reference internal" href="ref/entity_event.html#entity_event.models.Source" title="entity_event.models.Source"><tt class="xref py py-class docutils literal"><span class="pre">Source</span></tt></a> objects,
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a> objects are simple to create</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">entity_event</span> <span class="kn">import</span> <span class="n">Medium</span>

<span class="n">email_medium</span> <span class="o">=</span> <span class="n">Medium</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">,</span>
    <span class="n">display_name</span><span class="o">=</span><span class="s">&quot;Email&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">&quot;Email Notifications&quot;</span>
<span class="p">)</span>

<span class="n">newsfeed_medium</span> <span class="o">=</span> <span class="n">Medium</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;newsfeed&quot;</span><span class="p">,</span>
    <span class="n">display_name</span><span class="o">=</span><span class="s">&quot;NewsFeed&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">&quot;Your personal feed of events&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>At first, none of the events we have been creating are accessible by
either of these mediums. In order for the mediums to have access to
the events, an appropriate
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Subscription" title="entity_event.models.Subscription"><tt class="xref py py-class docutils literal"><span class="pre">Subscription</span></tt></a> object needs to be
created. Creating a <a class="reference internal" href="ref/entity_event.html#entity_event.models.Subscription" title="entity_event.models.Subscription"><tt class="xref py py-class docutils literal"><span class="pre">Subscription</span></tt></a>
object encodes that an entity, or group of entities, wants to receive
notifications of events from a given source, by a given medium. For
example, we can create a subscription so that all the sub-entities of
an <tt class="docutils literal"><span class="pre">all_users</span></tt> entity will receive notifications of new products in
their newsfeed</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">entity</span> <span class="kn">import</span> <span class="n">EntityKind</span>
<span class="kn">from</span> <span class="nn">entity_event</span> <span class="kn">import</span> <span class="n">Subscription</span>

<span class="n">Subscription</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">medium</span><span class="o">=</span><span class="n">newsfeed_medium</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="n">product_source</span><span class="p">,</span>
    <span class="n">entity</span><span class="o">=</span><span class="n">all_users</span><span class="p">,</span>
    <span class="n">sub_entity_kind</span><span class="o">=</span><span class="n">EntityKind</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;user&#39;</span><span class="p">),</span>
    <span class="n">only_following</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>
</pre></div>
</div>
<p>With this <a class="reference internal" href="ref/entity_event.html#entity_event.models.Subscription" title="entity_event.models.Subscription"><tt class="xref py py-class docutils literal"><span class="pre">Subscription</span></tt></a> object
defined, all events from the new product source will be available to
the newsfeed medium.</p>
<p>If we wanted to create a subscription for users to get email
notifications when they&#8217;ve been tagged in a photo, we will also create
a <a class="reference internal" href="ref/entity_event.html#entity_event.models.Subscription" title="entity_event.models.Subscription"><tt class="xref py py-class docutils literal"><span class="pre">Subscription</span></tt></a> object. However,
unlike the new product events, not every event from the photos source
is relevant to every user. We want to limit the events they receive
emails about to the events where they are tagged in the photo.</p>
<p>In code above, you may notice the <tt class="docutils literal"><span class="pre">only_following=False</span></tt>
argument. This argument controls whether all events are relevant for
the subscription, or if the events are only relevant if they are
related to the entities being subscribed. Since new products are
relevant to all users, we set this to <tt class="docutils literal"><span class="pre">False</span></tt>. To create a
subscription for users to receive emails about photos they&#8217;re tagged
in, we&#8217;ll define the subscription as follows</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Subscription</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">medium</span><span class="o">=</span><span class="n">email_medium</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="n">photo_source</span><span class="p">,</span>
    <span class="n">entity</span><span class="o">=</span><span class="n">all_users</span><span class="p">,</span>
    <span class="n">sub_entity_kind</span><span class="o">=</span><span class="n">EntityKind</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;user&#39;</span><span class="p">),</span>
    <span class="n">only_following</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This will only notify users if an entity they&#8217;re following is tagged
in a photo. By default, entities follow themselves and their super
entities.</p>
<p>Creating subscriptions for a whole group of people with a single entry
into the database is very powerful. However, some users may wish to
opt out of certain types of notifications. To accommodate this, we can
create an <a class="reference internal" href="ref/entity_event.html#entity_event.models.Unsubscription" title="entity_event.models.Unsubscription"><tt class="xref py py-class docutils literal"><span class="pre">Unsubscription</span></tt></a>
object. These are used to unsubscribe a single entity from receiving
notifications of a given source on a given medium. For example if a
user wants to opt out of new product notifications in their newsfeed,
we can create an <a class="reference internal" href="ref/entity_event.html#entity_event.models.Unsubscription" title="entity_event.models.Unsubscription"><tt class="xref py py-class docutils literal"><span class="pre">Unsubscription</span></tt></a>
object for them</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">entity_event</span> <span class="kn">import</span> <span class="n">Unsubscription</span>

<span class="c"># Assume we have an entity, unsubscriber who wants to unsubscribe</span>
<span class="n">Unsubscription</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">entity</span><span class="o">=</span><span class="n">unsubscriber</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="n">product_source</span><span class="p">,</span>
    <span class="n">medium</span><span class="o">=</span><span class="n">newsfeed_medium</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Once this object is stored in the database, this user will no longer
receive this type of notification.</p>
<p>Once we have <a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a> objects set up
for the methods of sending notifications, and we have our entities
subscribed to sources of events on those mediums, we can use the
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a> objects to query for events,
which we can then display to our users.</p>
</div>
<div class="section" id="querying-events">
<h2>Querying Events<a class="headerlink" href="#querying-events" title="Permalink to this headline">¶</a></h2>
<p>Once we&#8217;ve got events being created, and subscriptions to them for a
given medium, we&#8217;ll want to display those events to our users. When
there are a large variety of events coming into the system from many
different sources, it would be very difficult to query the
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Event" title="entity_event.models.Event"><tt class="xref py py-class docutils literal"><span class="pre">Event</span></tt></a> model directly while still
respecting all the <a class="reference internal" href="ref/entity_event.html#entity_event.models.Subscription" title="entity_event.models.Subscription"><tt class="xref py py-class docutils literal"><span class="pre">Subscription</span></tt></a> logic
that we hope to maintain.</p>
<p>For this reason, Django Entity Event provides three methods to make
querying for events` to display extremely simple. Since the
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a> objects you&#8217;ve created should
correspond directly to a means by which you want to display events to
users, there are three methods of the
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a> class to perform queries.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium.events" title="entity_event.models.Medium.events"><tt class="xref py py-meth docutils literal"><span class="pre">Medium.events</span></tt></a></li>
<li><a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium.entity_events" title="entity_event.models.Medium.entity_events"><tt class="xref py py-meth docutils literal"><span class="pre">Medium.entity_events</span></tt></a></li>
<li><a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium.events_targets" title="entity_event.models.Medium.events_targets"><tt class="xref py py-meth docutils literal"><span class="pre">Medium.events_targets</span></tt></a></li>
</ol>
<p>Each of these methods return somewhat different views into the events
that are being stored in the system. In each case, though, you will
call these methods from an instance of
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium" title="entity_event.models.Medium"><tt class="xref py py-class docutils literal"><span class="pre">Medium</span></tt></a>, and the events returned will
only be events for which there is a corresponding
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Subscription" title="entity_event.models.Subscription"><tt class="xref py py-class docutils literal"><span class="pre">Subscription</span></tt></a> object.</p>
<p>The <a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium.events" title="entity_event.models.Medium.events"><tt class="xref py py-meth docutils literal"><span class="pre">Medium.events</span></tt></a>
method can be used to return all the events for that medium. This
method is useful for mediums that want to display events without any
particular regard for who performed the events. For example, we could
have a medium that aggregated all of the events from the new products
source. If we had a medium, <tt class="docutils literal"><span class="pre">all_products_medium</span></tt>, with the
appropriate subscriptions set up, getting all the new product events
is as simple as</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">all_products_medium</span><span class="o">.</span><span class="n">events</span><span class="p">()</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium.entity_events" title="entity_event.models.Medium.entity_events"><tt class="xref py py-meth docutils literal"><span class="pre">Medium.entity_events</span></tt></a> method can be used to get
all the events for a given entity on that medium. It takes a single
entity as an argument, and returns all the events for that entity on
that medium. We could use this method to get events for an individual
entity&#8217;s newsfeed. If we have a large number of sources creating
events, with subscriptions between those sources and the newsfeed,
aggregating them into one QuerySet of events is as simple as</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">newsfeed_medium</span><span class="o">.</span><span class="n">entity_events</span><span class="p">(</span><span class="n">user_entity</span><span class="p">)</span>
</pre></div>
</div>
<p>There are some mediums that notify users of events independent of a
pageview&#8217;s request/response cycle. For example, an email medium will
want to process batches of events, and need information about who to
send the events to. For this use case, the
<a class="reference internal" href="ref/entity_event.html#entity_event.models.Medium.events_targets" title="entity_event.models.Medium.events_targets"><tt class="xref py py-meth docutils literal"><span class="pre">Medium.events_targets</span></tt></a> method can be
used. Instead of providing a <tt class="docutils literal"><span class="pre">EventQueryset</span></tt>, it provides a list of
tuples in the form <tt class="docutils literal"><span class="pre">(event,</span> <span class="pre">targets)</span></tt>, where <tt class="docutils literal"><span class="pre">targets</span></tt> is a list
of the entities that should receive that notification. We could use
this function to send emails about events as follows</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.mail</span> <span class="kn">import</span> <span class="n">send_mail</span>

<span class="n">new_emails</span> <span class="o">=</span> <span class="n">email_medium</span><span class="o">.</span><span class="n">events_targets</span><span class="p">(</span><span class="n">seen</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">mark_seen</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">new_emails</span><span class="p">:</span>
    <span class="n">send_mail</span><span class="p">(</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&quot;subject&quot;</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&quot;message&quot;</span><span class="p">]</span>
        <span class="n">recipient_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">entity_meta</span><span class="p">[</span><span class="s">&quot;email&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>As seen in the last example, these methods also support a number of
arguments for filtering the events based on properties of the events
themselves. All three methods support the following arguments:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">start_time</span></tt>: providing a datetime object to this parameter will
filter the events to only those that occurred at or after this time.</li>
<li><tt class="docutils literal"><span class="pre">end_time</span></tt>: providing a datetime object to this parameter will
filter the events to only those that occurred at or before this time.</li>
<li><tt class="docutils literal"><span class="pre">seen</span></tt>: passing <tt class="docutils literal"><span class="pre">False</span></tt> to this argument will filter the events
to only those which have not been marked as having been seen.</li>
<li><tt class="docutils literal"><span class="pre">include_expired</span></tt>: defaults to <tt class="docutils literal"><span class="pre">False</span></tt>, passing <tt class="docutils literal"><span class="pre">True</span></tt> to this
argument will include events that are expired. Events with
expiration are discussed in
<a class="reference internal" href="ref/entity_event.html#entity_event.models.EventManager.create_event" title="entity_event.models.EventManager.create_event"><tt class="xref py py-meth docutils literal"><span class="pre">create_event()</span></tt></a>.</li>
<li><tt class="docutils literal"><span class="pre">actor</span></tt>: providing an entity to this parameter will filter the
events to only those that include the given entity as an actor.</li>
</ul>
<p>Finally, all of these methods take an argument <tt class="docutils literal"><span class="pre">mark_seen</span></tt>. Passing
<tt class="docutils literal"><span class="pre">True</span></tt> to this argument will mark the events as having been seen by
that medium so they will not show up if <tt class="docutils literal"><span class="pre">False</span></tt> is passed to the
<tt class="docutils literal"><span class="pre">seen</span></tt> filtering argument.</p>
<p>Using these three methods with any combination of the event filters
should make virtually any event querying task simple.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="advanced_features.html" class="btn btn-neutral float-right" title="Advanced Features"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Ambition Inc..
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>